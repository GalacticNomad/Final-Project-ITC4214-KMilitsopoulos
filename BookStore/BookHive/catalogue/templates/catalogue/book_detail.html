{% extends "core/layout.html" %}

{% load static %}

{% block scripts %}
<script src="{% static 'js/rating.js' %}" defer></script>
<!-- Include the rating.js script with defer in order not to interupt loading-->
{% endblock %}


{% block title %}{{ book.title }}{% endblock %}
<!-- Sets the title of the page -->

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-4 text-center">
            {% if book.cover_image %}
                <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="img-fluid rounded shadow-sm">
            {% else %}
                <img src="{% static 'images/cover-coming-soon.png' %}" alt="Default Book Cover" class="img-fluid rounded shadow-sm">
            {% endif %}
        </div>
        <div class="col">
            <h1>{{ book.title }}</h1>
            <h2>by {{ book.author }}</h2>
            <p>{{ book.description }}</p>
            <p><strong>Genre:</strong> {{ book.genre.name }}</p>
            {% if book.subgenre %}
                <p><strong>Subgenre:</strong> {{ book.subgenre.name }}</p>
            {% endif %}

            {% if user.is_authenticated %}
            <!-- Rating section is shown only if the user is logged in with a valid profile as well as cart button -->
            <div id="rating-section" class="mt-4">
                <h2>Rate this Book</h2>
                <form id="rating-form" action="{% url 'catalogue:submit_rating' book.id %}">
                    {% csrf_token %}
                    <!-- for security-->
                    <div class="rating">
                        <!-- Rating stars https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_star_rating  -->
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                    <input type="hidden" name="rating" id="rating-value">
                    <!-- Hidden input to store the rating value -->
                    <button type="submit" class="btn btn-primary mt-2">Submit Rating</button>
                    <!-- Submit button for the rating form -->
                </form>
                <div id="current-rating">
                    <h2>Current Rating: {{ average_rating|default_if_none:"No ratings yet." }}</h2>
                    <!-- Display the current rating or a default message if no ratings yet -->
                </div>
            </div>
            {% endif %}
            <button class="btn btn-success add-to-cart" data-book-id="{{ book.id }}" data-book-title="{{ book.title }}" data-book-author="{{ book.author }}">Add to Cart</button>
        </div>
    </div>
    <a href="javascript:history.back()" class="btn btn-secondary mt-3">Go Back</a>
    </div>
</div>
{% endblock %}
